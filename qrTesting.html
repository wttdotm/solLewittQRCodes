<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<title>Page Title</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="">
<style>
  body {
  font-family: 'Source Code Pro', monospace;
}
@import url('https://web.archive.org/web/20230512043741cs_/https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap');
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<body>

<!-- <img src="img_la.jpg" alt="LA" style="width:100%"> -->

<div id="qrcode"></div>
<div id="instructions">
  <p>Make a 21x21 square grid</p>

 <p>Divide it into nine squares of 7x7 units each</p>
  
  Within the upper left, upper right, and bottom left squares, make the same shape, a square with:<br/>
  An internal black border one unit thick<br/>
  A white border one unit thick within that black border<br/>
  A black 3x3 square within that white border<br/></div>
<script type="text/javascript">
  const searchParams = new URLSearchParams(window.location.search);

  const qrText = searchParams.get('qrCode') 
  var qrcode = new QRCode(document.getElementById("qrcode"), {
    text: qrText || "69",
    width: 128,
    height: 128,
    colorDark : "#000000",
    colorLight : "#ffffff",
    correctLevel : QRCode.CorrectLevel.Q
  });
  console.log(qrcode)


  let qrAsTFArray = qrcode._oQRCode.modules

  if (qrAsTFArray.length > 21) alert('2 big')

  console.log(qrcode._oQRCode.modules)

  let positionToWordArr = ['first', 'second', 'third', 'fourth', 'fifth', 'sixth', 'final']

  function moreBlack (arr) {
    let totalBlack = 0
    let totalWhite = 0
    arr.forEach(el => {
      if (el) totalBlack++
      else totalWhite++
    })
    return totalBlack > totalWhite ? true : false
  }

  function colToArr (arr, col) {
    let colArr = []
    arr.forEach(el => {
      colArr.push(el[col])
    })
    return colArr
  }


  function describeArr (arr) {
    let isMoreBlack = moreBlack(arr)

    //this .find method is a bad way to do this but oh well
    //row is all black
    if (isMoreBlack && arr.find(el => el !== isMoreBlack) === undefined) return "black"
    //row is all white
    if (!isMoreBlack && arr.find(el => el !== isMoreBlack) === undefined) return "white"

    //find all instances of minorityCells
    let minorityCells = []
    arr.forEach((cell, ind) => {
      if (isMoreBlack && !cell) minorityCells.push(ind)
      if (!isMoreBlack && cell) minorityCells.push(ind)
    })


    //cases (ironically the oxford comma makes this annoying):
    switch (minorityCells.length) {
      //1 min cell (__)
      case 1:
        return `${isMoreBlack ? 'black' : 'white'}, except the ${positionToWordArr[minorityCells[0]]} cell, which should be ${!isMoreBlack ? 'black' : 'white'}`
        break
        //2 min cells (_ and _)
      case 2:
        return `${isMoreBlack ? 'black' : 'white'}, except the ${positionToWordArr[minorityCells[0]]} and ${positionToWordArr[minorityCells[1]]} cells, which should be ${!isMoreBlack ? 'black' : 'white'}`
        break
      //3 min cells (_, __, and )
      case 3:
        return `${isMoreBlack ? 'black' : 'white'}, except the ${positionToWordArr[minorityCells[0]]}, ${positionToWordArr[minorityCells[1]]}, and ${positionToWordArr[minorityCells[2]]} cells, which should be ${!isMoreBlack ? 'black' : 'white'}`
    }

  }

  function describeColumn (arr, col) {
    let colAsArr = colToArr(arr, col)
    let secondHalf = describeArr(colAsArr)
    let returnedString = `Fill in the ${positionToWordArr[col]} column with ${secondHalf}`
    document.getElementById("instructions").innerHTML += returnedString + '<br>';
    console.log(returnedString)
  }

  function describeRow (arr, ind) {
    let secondHalf = describeArr(arr)
    let returnedString = `Fill in the ${positionToWordArr[ind]} row with ${secondHalf}`
    document.getElementById("instructions").innerHTML += returnedString + '<br>';
    console.log(returnedString)
  }


  // array splitting tedium
  let topMiddleArr = []
  for (let i = 0; i < 7; i++) {
    let arrToPush = []
    for (let j = 7; j < 14; j++) {
      arrToPush.push(qrAsTFArray[i][j])
    }
    topMiddleArr.push(arrToPush)
  }

  let centerLeftArr = []
  for (let i = 7; i < 14; i++) {
    let arrToPush = []
    for (let j = 0; j < 7; j++) {
      arrToPush.push(qrAsTFArray[i][j])
    }
    centerLeftArr.push(arrToPush)
  }

  let centerMiddleArr = []
  for (let i = 7; i < 14; i++) {
    let arrToPush = []
    for (let j = 7; j < 14; j++) {
      arrToPush.push(qrAsTFArray[i][j])
    }
    centerMiddleArr.push(arrToPush)
  }

  let centerRightArr = []
  for (let i = 7; i < 14; i++) {
    let arrToPush = []
    for (let j = 14; j < 21; j++) {
      arrToPush.push(qrAsTFArray[i][j])
    }
    centerRightArr.push(arrToPush)
  }

  let bottomMiddleArr = []
  for (let i = 14; i < 21; i++) {
    let arrToPush = []
    for (let j = 7; j < 14; j++) {
      arrToPush.push(qrAsTFArray[i][j])
    }
    bottomMiddleArr.push(arrToPush)
  }

  let bottomRightArr = []
  for (let i = 14; i < 21; i++) {
    let arrToPush = []
    for (let j = 14; j < 21; j++) {
      arrToPush.push(qrAsTFArray[i][j])
    }
    bottomRightArr.push(arrToPush)
  }

  // row-based ones:
  // centerLeftArr, centerRightArr, centerMiddleArr (either but easier to keep a row for middle consistency)

  // col-based ones: 
  // topMiddleArr, bottomMiddleArr, bottomRightArr

  function processColBasedArr (arr, pos) {
    console.log(`For the ${pos} square, fill it in as follows:`)
    document.getElementById("instructions").innerHTML += `<br/> For the ${pos} square, fill it in as follows: <br/>`;
    // not using a forEach here bc we are technically not iterating thru the parent arr
    for (let i = 0; i < arr.length; i++) {
      describeColumn(arr, i)
    }
  }

  function processRowBasedArr (arr, pos) {
    console.log(`For the ${pos} square, fill it in as follows:`)
    document.getElementById("instructions").innerHTML += `<br/> For the ${pos} square, fill it in as follows: <br/>`;
    arr.forEach((el, ind) => describeRow(el, ind))
  }

  //do these in order, top to bottom, ltr
  processColBasedArr(topMiddleArr, 'upper middle')
  processRowBasedArr(centerLeftArr, 'center left')
  processRowBasedArr(centerMiddleArr, 'center')
  processRowBasedArr(centerRightArr, 'center right')
  processColBasedArr(bottomMiddleArr, 'lower middle')
  processColBasedArr(bottomRightArr, 'lower right')




</script>

</body>
</html>